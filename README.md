# GCP Centralized Logging & Visualization Scaffold

This repository contains the infrastructure code, configuration, and application code for a scalable, organization-wide logging solution on Google Cloud Platform.

## Architecture

The solution uses a **Hub-and-Spoke** logging model at the Organization level:
1.  **Ingestion**: All logs (Application, Audit, System) from all Projects in the Org are intercepted by Organization Logging Sinks.
2.  **Storage (Hot/Analytics)**: `org-central-sink-bq` -> BigQuery Dataset (`central_logging_v1`).
    - Used for: Deep analysis, SQL querying, long-term trend analysis.
3.  **Storage (Cold/Compliance)**: `org-central-sink-gcs` -> GCS Bucket (`dacvisuals-central-logs-archive-v1`).
    - Lifecycle: 30 days Standard -> 90 days Coldline -> 365 days Archive.
4.  **Real-Time (Alerting)**: `org-central-sink-alerts` -> Pub/Sub (`logging-critical-alerts`).
    - Used for: Triggering Cloud Functions or external webhooks for `ERROR` and `CRITICAL` logs.

## Directory Structure

```
GCP_LOGGING/
├── app/
│   └── glass-pane/       # Cloud Run Application (Flask) for visualizing BigQuery logs
├── config/
│   ├── gcs_lifecycle.json # Lifecycle rules for Archive bucket
│   └── ...               # Previous config backups
├── dashboards/
│   └── glass_pane.json   # Cloud Monitoring Dashboard definition
├── functions/
│   └── log-processor/    # Cloud Function triggered by Pub/Sub for real-time alerting
├── scripts/
│   └── deploy_scaffold.sh # Master deployment script
└── README.md
```

## Deployment Guide

### 1. Prerequisite
Ensure you are authenticated as an Org Admin:
```bash
gcloud auth login
gcloud config set project diatonic-ai-gcp
```

### 2. Deploy Infrastructure
Run the scaffold script to create Buckets, Datasets, Topics, and Sinks:
```bash
cd scripts
./deploy_scaffold.sh
```
*Note: This script handles IAM binding creation for the unique writer identities generated by the Sinks.*

### 3. Deploy "Glass Pane" App
Build and deploy the visualization app to Cloud Run:
```bash
cd app/glass-pane
gcloud builds submit --tag gcr.io/diatonic-ai-gcp/glass-pane
gcloud run deploy glass-pane --image gcr.io/diatonic-ai-gcp/glass-pane --platform managed --allow-unauthenticated
```

### 4. Deploy Dashboard
Import the dashboard configuration:
```bash
gcloud monitoring dashboards create --config-from-file=dashboards/glass_pane.json
```

## Future Roadmap
- **Multi-Cloud**: Use Google Cloud Logging Agent (BindPlane or Fluentd) on AWS/Azure to forward logs to this central BigQuery dataset.
- **On-Prem**: Install Fluentd with the Cloud Logging plugin on on-prem servers.
